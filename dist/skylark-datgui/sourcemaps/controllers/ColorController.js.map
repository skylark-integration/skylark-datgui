{"version":3,"sources":["controllers/ColorController.js"],"names":["define","Controller","dom","Color","interpret","common","vendors","linearGradient","elem","x","a","b","style","background","each","vendor","cssText","[object Object]","object","property","super","this","__color","getValue","__temp","_this","domElement","document","createElement","makeSelectable","__selector","className","__saturation_field","__field_knob","__field_knob_border","__hue_knob","__hue_field","__input","type","__input_textShadow","bind","e","keyCode","onBlur","call","addClass","window","removeClass","valueField","fieldDown","setSV","fieldUpSV","fieldDownH","setH","fieldUpH","unbind","onFinish","i","value","__state","setValue","toOriginal","toString","__onFinishChange","indexOf","preventDefault","fieldRect","getBoundingClientRect","clientX","clientY","touches","s","left","right","v","top","bottom","h","extend","width","height","padding","backgroundColor","boxShadow","position","border","borderRadius","zIndex","borderRight","marginRight","display","cursor","outline","textAlign","color","fontWeight","textShadow","appendChild","updateDisplay","mismatch","COMPONENTS","component","isUndefined","flip","_flip","marginLeft","marginTop","toHexString"],"mappings":"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","file":"../../controllers/ColorController.js","sourcesContent":["define([\n    './Controller',\n    '../dom/dom',\n    '../color/Color',\n    '../color/interpret',\n    '../utils/common'\n], function (Controller, dom, Color, interpret, common) {\n    'use strict';\n    class ColorController extends Controller {\n        constructor(object, property) {\n            super(object, property);\n            this.__color = new Color(this.getValue());\n            this.__temp = new Color(0);\n            const _this = this;\n            this.domElement = document.createElement('div');\n            dom.makeSelectable(this.domElement, false);\n            this.__selector = document.createElement('div');\n            this.__selector.className = 'selector';\n            this.__saturation_field = document.createElement('div');\n            this.__saturation_field.className = 'saturation-field';\n            this.__field_knob = document.createElement('div');\n            this.__field_knob.className = 'field-knob';\n            this.__field_knob_border = '2px solid ';\n            this.__hue_knob = document.createElement('div');\n            this.__hue_knob.className = 'hue-knob';\n            this.__hue_field = document.createElement('div');\n            this.__hue_field.className = 'hue-field';\n            this.__input = document.createElement('input');\n            this.__input.type = 'text';\n            this.__input_textShadow = '0 1px 1px ';\n            dom.bind(this.__input, 'keydown', function (e) {\n                if (e.keyCode === 13) {\n                    onBlur.call(this);\n                }\n            });\n            dom.bind(this.__input, 'blur', onBlur);\n            dom.bind(this.__selector, 'mousedown', function () {\n                dom.addClass(this, 'drag').bind(window, 'mouseup', function () {\n                    dom.removeClass(_this.__selector, 'drag');\n                });\n            });\n            dom.bind(this.__selector, 'touchstart', function () {\n                dom.addClass(this, 'drag').bind(window, 'touchend', function () {\n                    dom.removeClass(_this.__selector, 'drag');\n                });\n            });\n            const valueField = document.createElement('div');\n            common.extend(this.__selector.style, {\n                width: '122px',\n                height: '102px',\n                padding: '3px',\n                backgroundColor: '#222',\n                boxShadow: '0px 1px 3px rgba(0,0,0,0.3)'\n            });\n            common.extend(this.__field_knob.style, {\n                position: 'absolute',\n                width: '12px',\n                height: '12px',\n                border: this.__field_knob_border + (this.__color.v < 0.5 ? '#fff' : '#000'),\n                boxShadow: '0px 1px 3px rgba(0,0,0,0.5)',\n                borderRadius: '12px',\n                zIndex: 1\n            });\n            common.extend(this.__hue_knob.style, {\n                position: 'absolute',\n                width: '15px',\n                height: '2px',\n                borderRight: '4px solid #fff',\n                zIndex: 1\n            });\n            common.extend(this.__saturation_field.style, {\n                width: '100px',\n                height: '100px',\n                border: '1px solid #555',\n                marginRight: '3px',\n                display: 'inline-block',\n                cursor: 'pointer'\n            });\n            common.extend(valueField.style, {\n                width: '100%',\n                height: '100%',\n                background: 'none'\n            });\n            linearGradient(valueField, 'top', 'rgba(0,0,0,0)', '#000');\n            common.extend(this.__hue_field.style, {\n                width: '15px',\n                height: '100px',\n                border: '1px solid #555',\n                cursor: 'ns-resize',\n                position: 'absolute',\n                top: '3px',\n                right: '3px'\n            });\n            hueGradient(this.__hue_field);\n            common.extend(this.__input.style, {\n                outline: 'none',\n                textAlign: 'center',\n                color: '#fff',\n                border: 0,\n                fontWeight: 'bold',\n                textShadow: this.__input_textShadow + 'rgba(0,0,0,0.7)'\n            });\n            dom.bind(this.__saturation_field, 'mousedown', fieldDown);\n            dom.bind(this.__saturation_field, 'touchstart', fieldDown);\n            dom.bind(this.__field_knob, 'mousedown', fieldDown);\n            dom.bind(this.__field_knob, 'touchstart', fieldDown);\n            dom.bind(this.__hue_field, 'mousedown', fieldDownH);\n            dom.bind(this.__hue_field, 'touchstart', fieldDownH);\n            function fieldDown(e) {\n                setSV(e);\n                dom.bind(window, 'mousemove', setSV);\n                dom.bind(window, 'touchmove', setSV);\n                dom.bind(window, 'mouseup', fieldUpSV);\n                dom.bind(window, 'touchend', fieldUpSV);\n            }\n            function fieldDownH(e) {\n                setH(e);\n                dom.bind(window, 'mousemove', setH);\n                dom.bind(window, 'touchmove', setH);\n                dom.bind(window, 'mouseup', fieldUpH);\n                dom.bind(window, 'touchend', fieldUpH);\n            }\n            function fieldUpSV() {\n                dom.unbind(window, 'mousemove', setSV);\n                dom.unbind(window, 'touchmove', setSV);\n                dom.unbind(window, 'mouseup', fieldUpSV);\n                dom.unbind(window, 'touchend', fieldUpSV);\n                onFinish();\n            }\n            function fieldUpH() {\n                dom.unbind(window, 'mousemove', setH);\n                dom.unbind(window, 'touchmove', setH);\n                dom.unbind(window, 'mouseup', fieldUpH);\n                dom.unbind(window, 'touchend', fieldUpH);\n                onFinish();\n            }\n            function onBlur() {\n                const i = interpret(this.value);\n                if (i !== false) {\n                    _this.__color.__state = i;\n                    _this.setValue(_this.__color.toOriginal());\n                } else {\n                    this.value = _this.__color.toString();\n                }\n            }\n            function onFinish() {\n                if (_this.__onFinishChange) {\n                    _this.__onFinishChange.call(_this, _this.__color.toOriginal());\n                }\n            }\n            this.__saturation_field.appendChild(valueField);\n            this.__selector.appendChild(this.__field_knob);\n            this.__selector.appendChild(this.__saturation_field);\n            this.__selector.appendChild(this.__hue_field);\n            this.__hue_field.appendChild(this.__hue_knob);\n            this.domElement.appendChild(this.__input);\n            this.domElement.appendChild(this.__selector);\n            this.updateDisplay();\n            function setSV(e) {\n                if (e.type.indexOf('touch') === -1) {\n                    e.preventDefault();\n                }\n                const fieldRect = _this.__saturation_field.getBoundingClientRect();\n                const {clientX, clientY} = e.touches && e.touches[0] || e;\n                let s = (clientX - fieldRect.left) / (fieldRect.right - fieldRect.left);\n                let v = 1 - (clientY - fieldRect.top) / (fieldRect.bottom - fieldRect.top);\n                if (v > 1) {\n                    v = 1;\n                } else if (v < 0) {\n                    v = 0;\n                }\n                if (s > 1) {\n                    s = 1;\n                } else if (s < 0) {\n                    s = 0;\n                }\n                _this.__color.v = v;\n                _this.__color.s = s;\n                _this.setValue(_this.__color.toOriginal());\n                return false;\n            }\n            function setH(e) {\n                if (e.type.indexOf('touch') === -1) {\n                    e.preventDefault();\n                }\n                const fieldRect = _this.__hue_field.getBoundingClientRect();\n                const {clientY} = e.touches && e.touches[0] || e;\n                let h = 1 - (clientY - fieldRect.top) / (fieldRect.bottom - fieldRect.top);\n                if (h > 1) {\n                    h = 1;\n                } else if (h < 0) {\n                    h = 0;\n                }\n                _this.__color.h = h * 360;\n                _this.setValue(_this.__color.toOriginal());\n                return false;\n            }\n        }\n        updateDisplay() {\n            const i = interpret(this.getValue());\n            if (i !== false) {\n                let mismatch = false;\n                common.each(Color.COMPONENTS, function (component) {\n                    if (!common.isUndefined(i[component]) && !common.isUndefined(this.__color.__state[component]) && i[component] !== this.__color.__state[component]) {\n                        mismatch = true;\n                        return {};\n                    }\n                }, this);\n                if (mismatch) {\n                    common.extend(this.__color.__state, i);\n                }\n            }\n            common.extend(this.__temp.__state, this.__color.__state);\n            this.__temp.a = 1;\n            const flip = this.__color.v < 0.5 || this.__color.s > 0.5 ? 255 : 0;\n            const _flip = 255 - flip;\n            common.extend(this.__field_knob.style, {\n                marginLeft: 100 * this.__color.s - 7 + 'px',\n                marginTop: 100 * (1 - this.__color.v) - 7 + 'px',\n                backgroundColor: this.__temp.toHexString(),\n                border: this.__field_knob_border + 'rgb(' + flip + ',' + flip + ',' + flip + ')'\n            });\n            this.__hue_knob.style.marginTop = (1 - this.__color.h / 360) * 100 + 'px';\n            this.__temp.s = 1;\n            this.__temp.v = 1;\n            linearGradient(this.__saturation_field, 'left', '#fff', this.__temp.toHexString());\n            this.__input.value = this.__color.toString();\n            common.extend(this.__input.style, {\n                backgroundColor: this.__color.toHexString(),\n                color: 'rgb(' + flip + ',' + flip + ',' + flip + ')',\n                textShadow: this.__input_textShadow + 'rgba(' + _flip + ',' + _flip + ',' + _flip + ',.7)'\n            });\n        }\n    }\n    const vendors = [\n        '-moz-',\n        '-o-',\n        '-webkit-',\n        '-ms-',\n        ''\n    ];\n    function linearGradient(elem, x, a, b) {\n        elem.style.background = '';\n        common.each(vendors, function (vendor) {\n            elem.style.cssText += 'background: ' + vendor + 'linear-gradient(' + x + ', ' + a + ' 0%, ' + b + ' 100%); ';\n        });\n    }\n    function hueGradient(elem) {\n        elem.style.background = '';\n        elem.style.cssText += 'background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);';\n        elem.style.cssText += 'background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);';\n        elem.style.cssText += 'background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);';\n        elem.style.cssText += 'background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);';\n        elem.style.cssText += 'background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);';\n    }\n    return ColorController;\n});"]}