/**
 * skylark-datgui - A version of dat.gui.js  that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-datgui/
 * @license MIT
 */
define(["../utils/css","./saveDialogue.html","../controllers/ControllerFactory","../controllers/Controller","../controllers/BooleanController","../controllers/FunctionController","../controllers/NumberControllerBox","../controllers/NumberControllerSlider","../controllers/ColorController","../utils/requestAnimationFrame","../dom/CenteredDiv","../dom/dom","../utils/common"],function(e,t,n,o,s,i,l,r,d,c,a,_,u,h){"use strict";const m="Default",f=function(){try{return!!window.localStorage}catch(e){return!1}}();let p,b,C=!0,g=!1;const E=[],S=function(e){const t=this;let n=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),_.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],n=u.defaults(n,{closeOnTop:!1,autoPlace:!0,width:S.DEFAULT_WIDTH}),n=u.defaults(n,{resizable:n.autoPlace,hideable:n.autoPlace}),u.isUndefined(n.load)?n.load={preset:m}:n.preset&&(n.load.preset=n.preset),u.isUndefined(n.parent)&&n.hideable&&E.push(this),n.resizable=u.isUndefined(n.parent)&&n.resizable,n.autoPlace&&u.isUndefined(n.scrollable)&&(n.scrollable=!0);let o,s,i=f&&"true"===localStorage.getItem(T(this,"isLocal"));if(Object.defineProperties(this,{parent:{get:function(){return n.parent}},scrollable:{get:function(){return n.scrollable}},autoPlace:{get:function(){return n.autoPlace}},closeOnTop:{get:function(){return n.closeOnTop}},preset:{get:function(){return t.parent?t.getRoot().preset:n.load.preset},set:function(e){t.parent?t.getRoot().preset=e:n.load.preset=e,function(e){for(let t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}(this),t.revert()}},width:{get:function(){return n.width},set:function(e){n.width=e,R(t,e)}},name:{get:function(){return n.name},set:function(e){n.name=e,s&&(s.innerHTML=n.name)}},closed:{get:function(){return n.closed},set:function(e){n.closed=e,n.closed?_.addClass(t.__ul,S.CLASS_CLOSED):_.removeClass(t.__ul,S.CLASS_CLOSED),this.onResize(),t.__closeButton&&(t.__closeButton.innerHTML=e?S.TEXT_OPEN:S.TEXT_CLOSED)}},load:{get:function(){return n.load}},useLocalStorage:{get:function(){return i},set:function(e){f&&(i=e,e?_.bind(window,"unload",o):_.unbind(window,"unload",o),localStorage.setItem(T(t,"isLocal"),e))}}}),u.isUndefined(n.parent)){if(this.closed=n.closed||!1,_.addClass(this.domElement,S.CLASS_MAIN),_.makeSelectable(this.domElement,!1),f&&i){t.useLocalStorage=!0;const e=localStorage.getItem(T(this,"gui"));e&&(n.load=JSON.parse(e))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=S.TEXT_CLOSED,_.addClass(this.__closeButton,S.CLASS_CLOSE_BUTTON),n.closeOnTop?(_.addClass(this.__closeButton,S.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(_.addClass(this.__closeButton,S.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),_.bind(this.__closeButton,"click",function(){t.closed=!t.closed})}else{void 0===n.closed&&(n.closed=!0);const e=document.createTextNode(n.name);_.addClass(e,"controller-name"),s=L(t,e);const o=function(e){return e.preventDefault(),t.closed=!t.closed,!1};_.addClass(this.__ul,S.CLASS_CLOSED),_.addClass(s,"title"),_.bind(s,"click",o),n.closed||(this.closed=!1)}n.autoPlace&&(u.isUndefined(n.parent)&&(C&&(b=document.createElement("div"),_.addClass(b,"dg"),_.addClass(b,S.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(b),C=!1),b.appendChild(this.domElement),_.addClass(this.domElement,S.CLASS_AUTO_PLACE)),this.parent||R(t,n.width)),this.__resizeHandler=function(){t.onResizeDebounced()},_.bind(window,"resize",this.__resizeHandler),_.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),_.bind(this.__ul,"transitionend",this.__resizeHandler),_.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),n.resizable&&function(e){let t;function n(n){return n.preventDefault(),e.width+=t-n.clientX,e.onResize(),t=n.clientX,!1}function o(){_.removeClass(e.__closeButton,S.CLASS_DRAG),_.unbind(window,"mousemove",n),_.unbind(window,"mouseup",o)}function s(s){return s.preventDefault(),t=s.clientX,_.addClass(e.__closeButton,S.CLASS_DRAG),_.bind(window,"mousemove",n),_.bind(window,"mouseup",o),!1}e.__resize_handle=document.createElement("div"),u.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),_.bind(e.__resize_handle,"mousedown",s),_.bind(e.__closeButton,"mousedown",s),e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}(this),o=function(){f&&"true"===localStorage.getItem(T(t,"isLocal"))&&localStorage.setItem(T(t,"gui"),JSON.stringify(t.getSaveObject()))},this.saveToLocalStorageIfPossible=o,n.parent||function(){const e=t.getRoot();e.width+=1,u.defer(function(){e.width-=1})}()};function L(e,t,n){const o=document.createElement("li");return t&&o.appendChild(t),n?e.__ul.insertBefore(o,n):e.__ul.appendChild(o),e.onResize(),o}function w(e){_.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&_.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function y(e,t){const n=e.__preset_select[e.__preset_select.selectedIndex];n.innerHTML=t?n.value+"*":n.value}function v(e,t){const n=e.getRoot(),o=n.__rememberedObjects.indexOf(t.object);if(-1!==o){let s=n.__rememberedObjectIndecesToControllers[o];if(void 0===s&&(s={},n.__rememberedObjectIndecesToControllers[o]=s),s[t.property]=t,n.load&&n.load.remembered){const s=n.load.remembered;let i;if(s[e.preset])i=s[e.preset];else{if(!s[m])return;i=s[m]}if(i[o]&&void 0!==i[o][t.property]){const e=i[o][t.property];t.initialValue=e,t.setValue(e)}}}}function O(e,t,c,a){if(void 0===t[c])throw new Error(`Object "${t}" has no property "${c}"`);let h;if(a.color)h=new d(t,c);else{const o=[t,c].concat(a.factoryArgs);h=n.apply(e,o)}a.before instanceof o&&(a.before=a.before.__li),v(e,h),_.addClass(h.domElement,"c");const m=document.createElement("span");_.addClass(m,"property-name"),m.innerHTML=h.property;const f=document.createElement("div");f.appendChild(m),f.appendChild(h.domElement);const p=L(e,f,a.before);return _.addClass(p,S.CLASS_CONTROLLER_ROW),h instanceof d?_.addClass(p,"color"):_.addClass(p,typeof h.getValue()),function(e,t,n){if(n.__li=t,n.__gui=e,u.extend(n,{options:function(t){if(arguments.length>1){const t=n.__li.nextElementSibling;return n.remove(),O(e,n.object,n.property,{before:t,factoryArgs:[u.toArray(arguments)]})}if(u.isArray(t)||u.isObject(t)){const o=n.__li.nextElementSibling;return n.remove(),O(e,n.object,n.property,{before:o,factoryArgs:[t]})}},name:function(e){return n.__li.firstElementChild.firstElementChild.innerHTML=e,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof r){const e=new l(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});u.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(t){const o=n[t],s=e[t];n[t]=e[t]=function(){const t=Array.prototype.slice.call(arguments);return s.apply(e,t),o.apply(n,t)}}),_.addClass(t,"has-slider"),n.domElement.insertBefore(e.domElement,n.domElement.firstElementChild)}else if(n instanceof l){const t=function(t){if(u.isNumber(n.__min)&&u.isNumber(n.__max)){const t=n.__li.firstElementChild.firstElementChild.innerHTML,o=n.__gui.__listening.indexOf(n)>-1;n.remove();const s=O(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]});return s.name(t),o&&s.listen(),s}return t};n.min=u.compose(t,n.min),n.max=u.compose(t,n.max)}else n instanceof s?(_.bind(t,"click",function(){_.fakeEvent(n.__checkbox,"click")}),_.bind(n.__checkbox,"click",function(e){e.stopPropagation()})):n instanceof i?(_.bind(t,"click",function(){_.fakeEvent(n.__button,"click")}),_.bind(t,"mouseover",function(){_.addClass(n.__button,"hover")}),_.bind(t,"mouseout",function(){_.removeClass(n.__button,"hover")})):n instanceof d&&(_.addClass(t,"color"),n.updateDisplay=u.compose(function(e){return t.style.borderLeftColor=n.__color.toString(),e},n.updateDisplay),n.updateDisplay());n.setValue=u.compose(function(t){return e.getRoot().__preset_select&&n.isModified()&&y(e.getRoot(),!0),t},n.setValue)}(e,p,h),e.__controllers.push(h),h}function T(e,t){return document.location.href+"."+t}function A(e,t,n){const o=document.createElement("option");o.innerHTML=t,o.value=t,e.__preset_select.appendChild(o),n&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function x(e,t){t.style.display=e.useLocalStorage?"block":"none"}function R(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function B(e,t){const n={};return u.each(e.__rememberedObjects,function(o,s){const i={},l=e.__rememberedObjectIndecesToControllers[s];u.each(l,function(e,n){i[n]=t?e.initialValue:e.getValue()}),n[s]=i}),n}return S.toggleHide=function(){g=!g,u.each(E,function(e){e.domElement.style.display=g?"none":""})},S.CLASS_AUTO_PLACE="a",S.CLASS_AUTO_PLACE_CONTAINER="ac",S.CLASS_MAIN="main",S.CLASS_CONTROLLER_ROW="cr",S.CLASS_TOO_TALL="taller-than-window",S.CLASS_CLOSED="closed",S.CLASS_CLOSE_BUTTON="close-button",S.CLASS_CLOSE_TOP="close-top",S.CLASS_CLOSE_BOTTOM="close-bottom",S.CLASS_DRAG="drag",S.DEFAULT_WIDTH=245,S.TEXT_CLOSED="Close Controls",S.TEXT_OPEN="Open Controls",S._keydownHandler=function(e){"text"===document.activeElement.type||72!==e.which&&72!==e.keyCode||S.toggleHide()},_.bind(window,"keydown",S._keydownHandler,!1),u.extend(S.prototype,{add:function(e,t){return O(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return O(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);const t=this;u.defer(function(){t.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&b.removeChild(this.domElement);const e=this;u.each(this.__folders,function(t){e.removeFolder(t)}),_.unbind(window,"keydown",S._keydownHandler,!1),w(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');const t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);const n=new S(t);this.__folders[e]=n;const o=L(this,n.domElement);return _.addClass(o,"folder"),n},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],w(e);const t=this;u.each(e.__folders,function(t){e.removeFolder(t)}),u.defer(function(){t.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){const e=this.getRoot();if(e.scrollable){const t=_.getOffset(e.__ul).top;let n=0;u.each(e.__ul.childNodes,function(t){e.autoPlace&&t===e.__save_row||(n+=_.getHeight(t))}),window.innerHeight-t-20<n?(_.addClass(e.domElement,S.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-20+"px"):(_.removeClass(e.domElement,S.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&u.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:u.debounce(function(){this.onResize()},50),remember:function(){if(u.isUndefined(p)&&((p=new a).domElement.innerHTML=t),this.parent)throw new Error("You can only call remember on a top level GUI.");const e=this;u.each(Array.prototype.slice.call(arguments),function(t){0===e.__rememberedObjects.length&&function(e){const t=e.__save_row=document.createElement("li");_.addClass(e.domElement,"has-save"),e.__ul.insertBefore(t,e.__ul.firstChild),_.addClass(t,"save-row");const n=document.createElement("span");n.innerHTML="&nbsp;",_.addClass(n,"button gears");const o=document.createElement("span");o.innerHTML="Save",_.addClass(o,"button"),_.addClass(o,"save");const s=document.createElement("span");s.innerHTML="New",_.addClass(s,"button"),_.addClass(s,"save-as");const i=document.createElement("span");i.innerHTML="Revert",_.addClass(i,"button"),_.addClass(i,"revert");const l=e.__preset_select=document.createElement("select");e.load&&e.load.remembered?u.each(e.load.remembered,function(t,n){A(e,n,n===e.preset)}):A(e,m,!1);if(_.bind(l,"change",function(){for(let t=0;t<e.__preset_select.length;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value}),t.appendChild(l),t.appendChild(n),t.appendChild(o),t.appendChild(s),t.appendChild(i),f){const t=document.getElementById("dg-local-explain"),n=document.getElementById("dg-local-storage"),o=document.getElementById("dg-save-locally");o.style.display="block","true"===localStorage.getItem(T(e,"isLocal"))&&n.setAttribute("checked","checked"),x(e,t),_.bind(n,"change",function(){e.useLocalStorage=!e.useLocalStorage,x(e,t)})}const r=document.getElementById("dg-new-constructor");_.bind(r,"keydown",function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||p.hide()}),_.bind(n,"click",function(){r.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),p.show(),r.focus(),r.select()}),_.bind(o,"click",function(){e.save()}),_.bind(s,"click",function(){const t=prompt("Enter a new preset name.");t&&e.saveAs(t)}),_.bind(i,"click",function(){e.revert()})}(e),-1===e.__rememberedObjects.indexOf(t)&&e.__rememberedObjects.push(t)}),this.autoPlace&&R(this,this.width)},getRoot:function(){let e=this;for(;e.parent;)e=e.parent;return e},getSaveObject:function(){const e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=B(this)),e.folders={},u.each(this.__folders,function(t,n){e.folders[n]=t.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=B(this),y(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[m]=B(this,!0)),this.load.remembered[e]=B(this),this.preset=e,A(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){u.each(this.__controllers,function(t){this.getRoot().load.remembered?v(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())},this),u.each(this.__folders,function(e){e.revert(e)}),e||y(this.getRoot(),!1)},listen:function(e){const t=0===this.__listening.length;this.__listening.push(e),t&&function e(t){0!==t.length&&c.call(window,function(){e(t)});u.each(t,function(e){e.updateDisplay()})}(this.__listening)},updateDisplay:function(){u.each(this.__controllers,function(e){e.updateDisplay()}),u.each(this.__folders,function(e){e.updateDisplay()})}}),S});
//# sourceMappingURL=../sourcemaps/gui/GUI.js.map
